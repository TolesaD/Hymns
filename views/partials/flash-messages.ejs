<!-- Enhanced Flash Messages - Handles multiple messages -->
<% function displayFlashMessages(messages, type) { %>
    <% if (messages && messages.length > 0) { %>
        <% messages.forEach(function(message) { %>
            <div class="alert alert-<%= type %>">
                <i class="fas fa-<%= 
                    type === 'success' ? 'check-circle' : 
                    type === 'error' ? 'exclamation-circle' : 
                    type === 'warning' ? 'exclamation-triangle' : 'info-circle' 
                %>"></i>
                <p><%= message %></p>
                <button class="alert-close" onclick="this.parentElement.style.display='none'">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        <% }); %>
    <% } %>
<% } %>

<!-- Display all flash message types -->
<%= displayFlashMessages(success_msg, 'success') %>
<%= displayFlashMessages(error_msg, 'error') %>
<%= displayFlashMessages(info_msg, 'info') %>
<%= displayFlashMessages(warning_msg, 'warning') %>

<!-- Backward compatibility for single messages -->
<% if (success && success.length > 0) { %>
    <div class="alert alert-success">
        <i class="fas fa-check-circle"></i>
        <p><%= success %></p>
        <button class="alert-close" onclick="this.parentElement.style.display='none'">
            <i class="fas fa-times"></i>
        </button>
    </div>
<% } %>

<% if (error && error.length > 0) { %>
    <div class="alert alert-error">
        <i class="fas fa-exclamation-circle"></i>
        <p><%= error %></p>
        <button class="alert-close" onclick="this.parentElement.style.display='none'">
            <i class="fas fa-times"></i>
        </button>
    </div>
<% } %>

<% if (info && info.length > 0) { %>
    <div class="alert alert-info">
        <i class="fas fa-info-circle"></i>
        <p><%= info %></p>
        <button class="alert-close" onclick="this.parentElement.style.display='none'">
            <i class="fas fa-times"></i>
        </button>
    </div>
<% } %>

<style>
.alert {
    position: relative;
    padding: 1rem 1.5rem;
    margin: 1rem auto;
    border-radius: 8px;
    display: flex;
    align-items: center;
    gap: 1rem;
    border-left: 4px solid;
    animation: slideInDown 0.3s ease-out;
    max-width: 1200px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.alert-success {
    background: rgba(39, 174, 96, 0.1);
    border-left-color: #27ae60;
    color: #27ae60;
}

.alert-error {
    background: rgba(231, 76, 60, 0.1);
    border-left-color: #e74c3c;
    color: #e74c3c;
}

.alert-info {
    background: rgba(52, 152, 219, 0.1);
    border-left-color: #3498db;
    color: #3498db;
}

.alert-warning {
    background: rgba(243, 156, 18, 0.1);
    border-left-color: #f39c12;
    color: #f39c12;
}

.alert-close {
    background: none;
    border: none;
    color: inherit;
    cursor: pointer;
    margin-left: auto;
    padding: 0.5rem;
    font-size: 1rem;
    border-radius: 4px;
    transition: background-color 0.2s;
}

.alert-close:hover {
    background: rgba(0,0,0,0.1);
}

.alert i:first-child {
    font-size: 1.2rem;
}

@keyframes slideInDown {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Responsive design */
@media (max-width: 768px) {
    .alert {
        margin: 0.5rem;
        padding: 0.75rem 1rem;
    }
    
    .alert p {
        font-size: 0.9rem;
    }
}
</style>

<script>
// Enhanced auto-hide flash messages
document.addEventListener('DOMContentLoaded', function() {
    const alerts = document.querySelectorAll('.alert');
    
    alerts.forEach(alert => {
        // Auto-hide after 5 seconds
        const autoHide = setTimeout(() => {
            hideAlert(alert);
        }, 5000);
        
        // Manual close
        const closeBtn = alert.querySelector('.alert-close');
        if (closeBtn) {
            closeBtn.addEventListener('click', () => {
                clearTimeout(autoHide);
                hideAlert(alert);
            });
        }
        
        // Pause auto-hide on hover
        alert.addEventListener('mouseenter', () => {
            clearTimeout(autoHide);
        });
        
        alert.addEventListener('mouseleave', () => {
            setTimeout(() => {
                hideAlert(alert);
            }, 5000);
        });
    });
    
    function hideAlert(alert) {
        alert.style.opacity = '0';
        alert.style.transform = 'translateY(-10px)';
        setTimeout(() => {
            if (alert.parentNode) {
                alert.remove();
            }
        }, 300);
    }
});
</script>