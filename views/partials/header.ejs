<nav class="navbar">
    <div class="nav-container">
        <!-- Mobile Menu Toggle -->
        <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Toggle menu">
            <i class="fas fa-bars"></i>
        </button>
        
        <!-- Logo -->
        <div class="nav-logo">
            <a href="/">
                <img src="/assets/logo.png" alt="Hymns Logo" class="logo" 
                     onerror="this.style.display='none'; document.querySelector('.nav-logo span').style.marginLeft='0';">
                <span>Hymns</span>
            </a>
        </div>
        
        <!-- Search Bar -->
        <div class="nav-search">
            <form action="/search" method="GET">
                <div class="search-box">
                    <input type="text" name="q" placeholder="Search hymns..." id="search-input">
                    <button type="submit" aria-label="Search"><i class="fas fa-search"></i></button>
                </div>
            </form>
        </div>
        
        <!-- Main Navigation Menu -->
        <div class="nav-menu" id="navMenu">
            <a href="/" class="nav-link">Home</a>
            
            <!-- Languages Dropdown -->
            <div class="nav-dropdown">
                <a href="#" class="nav-link">
                    Languages <i class="fas fa-chevron-down"></i>
                </a>
                <div class="dropdown-content">
                    <a href="/amharic/worship">Amharic</a>
                    <a href="/oromo/worship">Afan Oromo</a>
                    <a href="/tigrigna/worship">Tigrigna</a>
                    <a href="/english/worship">English</a>
                </div>
            </div>
            
            <!-- User-specific links -->
            <% if (user && user.isAdmin) { %>
                <a href="/admin" class="nav-link">Admin</a>
            <% } %>
            
            <% if (user) { %>
                <a href="/users/profile" class="nav-link">Profile</a>
                <a href="/users/logout" class="nav-link">Logout</a>
            <% } else { %>
                <a href="/users/login" class="nav-link">Login</a>
                <a href="/users/register" class="nav-link btn-primary">Sign Up</a>
            <% } %>
        </div>
    </div>
</nav>

<script>
// Enhanced Mobile menu functionality - FIXED
document.addEventListener('DOMContentLoaded', function() {
    const mobileToggle = document.getElementById('mobileMenuToggle');
    const navMenu = document.getElementById('navMenu');
    const navDropdowns = document.querySelectorAll('.nav-dropdown');
    const body = document.body;
    
    console.log('ðŸ“± Mobile menu initialized - Elements found:', {
        mobileToggle: !!mobileToggle,
        navMenu: !!navMenu,
        navDropdowns: navDropdowns.length
    });
    
    // Mobile menu toggle - FIXED
    if (mobileToggle && navMenu) {
        mobileToggle.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            const isOpening = !navMenu.classList.contains('active');
            
            // Toggle menu
            navMenu.classList.toggle('active');
            this.classList.toggle('active');
            body.classList.toggle('menu-open', isOpening);
            
            // Toggle icon between bars and times
            const icon = this.querySelector('i');
            if (icon) {
                if (icon.classList.contains('fa-bars')) {
                    icon.classList.remove('fa-bars');
                    icon.classList.add('fa-times');
                } else {
                    icon.classList.remove('fa-times');
                    icon.classList.add('fa-bars');
                }
            }
            
            console.log('ðŸ“± Mobile menu ' + (isOpening ? 'opened' : 'closed'));
        });
        
        // Close menu when clicking outside
        document.addEventListener('click', function(e) {
            if (navMenu.classList.contains('active') && 
                !navMenu.contains(e.target) && 
                !mobileToggle.contains(e.target)) {
                closeMobileMenu();
            }
        });
        
        // Close menu when clicking on a link (except dropdown toggles)
        navMenu.addEventListener('click', function(e) {
            const target = e.target.closest('a');
            if (target) {
                // Don't close for dropdown toggles
                const isDropdownToggle = target.parentElement.classList.contains('nav-dropdown') && 
                                       target.querySelector('i.fa-chevron-down');
                if (!isDropdownToggle) {
                    closeMobileMenu();
                }
            }
        });
    }
    
    // Mobile dropdown functionality - FIXED
    navDropdowns.forEach(dropdown => {
        const link = dropdown.querySelector('.nav-link');
        
        if (link) {
            link.addEventListener('click', function(e) {
                if (window.innerWidth <= 768) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    // Close other dropdowns
                    navDropdowns.forEach(otherDropdown => {
                        if (otherDropdown !== dropdown) {
                            otherDropdown.classList.remove('active');
                        }
                    });
                    
                    // Toggle current dropdown
                    dropdown.classList.toggle('active');
                }
            });
        }
    });
    
    // Handle window resize
    window.addEventListener('resize', function() {
        if (window.innerWidth > 768) {
            closeMobileMenu();
        }
    });
    
    // Escape key to close menu
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && navMenu && navMenu.classList.contains('active')) {
            closeMobileMenu();
        }
    });
    
    // Close menu function
    function closeMobileMenu() {
        if (navMenu) {
            navMenu.classList.remove('active');
        }
        if (mobileToggle) {
            mobileToggle.classList.remove('active');
            const icon = mobileToggle.querySelector('i');
            if (icon) {
                icon.classList.remove('fa-times');
                icon.classList.add('fa-bars');
            }
        }
        body.classList.remove('menu-open');
        
        // Close all dropdowns
        navDropdowns.forEach(dropdown => {
            dropdown.classList.remove('active');
        });
    }
    
    // Initialize menu state
    closeMobileMenu();
});
</script>